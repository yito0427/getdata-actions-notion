name: 🔍 Exchange Survey (102 Exchanges)

on:
  workflow_dispatch:
    inputs:
      exchange_limit:
        description: 'Number of exchanges to survey (leave empty for all 102)'
        required: false
        type: string

jobs:
  survey-all-exchanges:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: 📥 Checkout repository
      uses: actions/checkout@v4
      
    - name: 🐍 Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: 📦 Install Poetry
      uses: snok/install-poetry@v1
      with:
        version: latest
        virtualenvs-create: true
        virtualenvs-in-project: true
        
    - name: 📚 Install dependencies
      run: poetry install --no-root
      
    - name: 🔍 Survey All 102 Exchanges
      env:
        NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
        NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
        LOG_LEVEL: INFO
      run: |
        if [ -z "${{ inputs.exchange_limit }}" ]; then
          echo "🌍 Surveying all 102 exchanges..."
          poetry run python scripts/survey_all_102_exchanges.py
        else
          echo "🔍 Surveying ${{ inputs.exchange_limit }} exchanges..."
          # Modify the script to accept limit parameter
          poetry run python scripts/explore_all_exchanges.py
        fi
        
    - name: 📊 Upload survey results
      uses: actions/upload-artifact@v4
      with:
        name: exchange-survey-results
        path: output/exchange_survey.json
        retention-days: 30